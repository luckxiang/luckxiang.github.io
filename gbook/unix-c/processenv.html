<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>进程环境 | 《UNIX环境高级编程》学习笔记</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="" name="description"/>
<meta content="GitBook 2.6.7" name="generator"/>
<meta content="true" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<link href="gitbook/images/apple-touch-icon-precomposed-152.png" rel="apple-touch-icon-precomposed" sizes="152x152"/>
<link href="gitbook/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="gitbook/style.css" rel="stylesheet"/>
<link href="gitbook/plugins/gitbook-plugin-highlight/website.css" rel="stylesheet"/>
<link href="gitbook/plugins/gitbook-plugin-search/search.css" rel="stylesheet"/>
<link href="gitbook/plugins/gitbook-plugin-fontsettings/website.css" rel="stylesheet"/>
<link href="./sysinfo.html" rel="prev"/>
</head>
<body>
<div class="book" data-basepath="." data-chapter-title="进程环境" data-filepath="processenv.md" data-innerlanguage="" data-level="7" data-revision="Tue Jun 28 2016 23:28:23 GMT+0800 (CST)">
<div class="book-summary">
<nav role="navigation">
<ul class="summary">
<li class="chapter " data-level="0" data-path="index.html">
<a href="./index.html">
<i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
</li>
<li class="chapter " data-level="1" data-path="unixbase.html">
<a href="./unixbase.html">
<i class="fa fa-check"></i>
<b>1.</b>
                        
                        UNIX 基础
                    </a>
</li>
<li class="chapter " data-level="2" data-path="unixstandard.html">
<a href="./unixstandard.html">
<i class="fa fa-check"></i>
<b>2.</b>
                        
                        UNIX标准及其实现
                    </a>
</li>
<li class="chapter " data-level="3" data-path="fileio.html">
<a href="./fileio.html">
<i class="fa fa-check"></i>
<b>3.</b>
                        
                        文件IO
                    </a>
</li>
<li class="chapter " data-level="4" data-path="filestat.html">
<a href="./filestat.html">
<i class="fa fa-check"></i>
<b>4.</b>
                        
                        文件属性
                    </a>
</li>
<li class="chapter " data-level="5" data-path="libio.html">
<a href="./libio.html">
<i class="fa fa-check"></i>
<b>5.</b>
                        
                        标准IO库
                    </a>
</li>
<li class="chapter " data-level="6" data-path="sysinfo.html">
<a href="./sysinfo.html">
<i class="fa fa-check"></i>
<b>6.</b>
                        
                        系统文件和信息
                    </a>
</li>
<li class="chapter active" data-level="7" data-path="processenv.html">
<a href="./processenv.html">
<i class="fa fa-check"></i>
<b>7.</b>
                        
                        进程环境
                    </a>
</li>
<li class="divider"></li>
<li>
<a class="homepage-back" href="http://www.bigxiangbaobao.com/book/" target="_self">
                        Back to Book</a>
</li>
</ul>
</nav>
</div>
<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">
<!-- Actions Left -->
<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="./">《UNIX环境高级编程》学习笔记</a>
</h1>
</div>
<div class="page-wrapper" role="main" tabindex="-1">
<div class="page-inner">
<section class="normal" id="section-">
<h1 id="进程环境">进程环境</h1>
<hr/>
<p>进程是操作系统的核心概念，学习进程的控制之前，需要先掌握进程的环境，这样我们就可以了解main程序是如何被调用的，命令行参数是如何传递给新程序的，典型的存储空间分布是什么样子，以及如何分配另外的存储空间，进程如何使用环境变量，进程如何终止等问题。</p>
<h4 id="main函数">main函数</h4>
<p>c程序总是从main函数开始的，在调用main之前会调用一个特殊的启动程序，一般是汇编程序，可执行文件一般把这个例程指定为程序的起始地址，这部分工作是连接器做的，启动例程从内核取得命令行参数和环境变量的值，然后为调用main函数做好准备。</p>
<h4 id="进程终止">进程终止</h4>
<p>进程终止有8种方式，其中五种是正常终止，3种异常终止：</p>
<ol>
<li>从main函数返回</li>
<li>调用exit</li>
<li>调用_exit,_Exit</li>
<li>最后一个线程从其启动例程返回</li>
<li>从最后一个线程调用pthread_exit</li>
<li>调用abort（异常）</li>
<li>接到一个信号（异常）</li>
<li>最后一个线程对取消请求作出响应（异常）</li>
</ol>
<p>一个进程可以登记最多32个终止处理函数，这些函数通过atexit注册，由exit自动调用，调用循序和他们登记时刚好相反，同一个函数如果登记多次，也会被调用多次。</p>
<pre><code>#include&lt;stdio.h&gt;

int atexit(void(*func)(void));
//成功返回0，出错返回非0
</code></pre><h4 id="命令行参数">命令行参数</h4>
<p>当执行一个新程序时，调用exec的进程可以把命令行参数传递给该新程序。这是UNIX shell的一部分常规操作。</p>
<h4 id="环境表">环境表</h4>
<p>每个程序都有一张环境表，环境表是一个字符指针数组，其中的每个指针包含一个NULL结尾的C字符串的地址，这串字符串就是一个环境变量，环境表可以通过环境指针environ获取。</p>
<h4 id="c程序的存储空间分布">C程序的存储空间分布</h4>
<p>C程序由下列几部分组成：</p>
<ul>
<li>正文段，只读可共享，是由CPU执行的机器指令部分，由exec从程序文件读入。</li>
<li>初始化数据段，由exec从文件读入。</li>
<li>未初始化数据段，他的内容并不由exec从文件读入并初始化为0，</li>
<li>栈</li>
<li>堆，历史原因，堆通常在栈和未初始化的数据段之间。
此外，程序文件还包括其它一些段，如符号表，调试信息等，但这些部分并不装载到进程执行的程序映像中。</li>
</ul>
</section>
</div>
</div>
</div>
<a aria-label="Previous page: 系统文件和信息" class="navigation navigation-prev navigation-unique" href="./sysinfo.html"><i class="fa fa-angle-left"></i></a>
</div>
</div>
<script src="gitbook/app.js"></script>
<script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
<script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
<script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
<script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>
</body>
</html>
