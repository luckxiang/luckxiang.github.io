<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>文件IO | 《UNIX环境高级编程》学习笔记</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="" name="description"/>
<meta content="GitBook 2.6.7" name="generator"/>
<meta content="true" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black" name="apple-mobile-web-app-status-bar-style"/>
<link href="gitbook/images/apple-touch-icon-precomposed-152.png" rel="apple-touch-icon-precomposed" sizes="152x152"/>
<link href="gitbook/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="gitbook/style.css" rel="stylesheet"/>
<link href="gitbook/plugins/gitbook-plugin-highlight/website.css" rel="stylesheet"/>
<link href="gitbook/plugins/gitbook-plugin-search/search.css" rel="stylesheet"/>
<link href="gitbook/plugins/gitbook-plugin-fontsettings/website.css" rel="stylesheet"/>
<link href="./unixstandard.html" rel="prev"/>
</head>
<body>
<div class="book" data-basepath="." data-chapter-title="文件IO" data-filepath="fileio.md" data-innerlanguage="" data-level="3" data-revision="Wed Jun 15 2016 00:21:50 GMT+0800 (CST)">
<div class="book-summary">
<nav role="navigation">
<ul class="summary">
<li class="chapter " data-level="0" data-path="index.html">
<a href="./index.html">
<i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
</li>
<li class="chapter " data-level="1" data-path="unixbase.html">
<a href="./unixbase.html">
<i class="fa fa-check"></i>
<b>1.</b>
                        
                        UNIX 基础
                    </a>
</li>
<li class="chapter " data-level="2" data-path="unixstandard.html">
<a href="./unixstandard.html">
<i class="fa fa-check"></i>
<b>2.</b>
                        
                        UNIX标准及其实现
                    </a>
</li>
<li class="chapter active" data-level="3" data-path="fileio.html">
<a href="./fileio.html">
<i class="fa fa-check"></i>
<b>3.</b>
                        
                        文件IO
                    </a>
</li>
<li class="divider"></li>
<li>
<a class="homepage-back" href="http://www.bigxiangbaobao.com" target="_self">
                        Back to Homepage</a>
</li>
</ul>
</nav>
</div>
<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">
<!-- Actions Left -->
<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="./">《UNIX环境高级编程》学习笔记</a>
</h1>
</div>
<div class="page-wrapper" role="main" tabindex="-1">
<div class="page-inner">
<section class="normal" id="section-">
<h1 id="文件io">文件IO</h1>
<p>UNIX的文件IO常被称为不带缓冲的IO，与之相对应的是标准IO，不带缓冲不是指不经过缓存区，而是说每一个read和write都调用内核中的系统调用，对于内核而言，所有打开的文件都通过文件描述符引用，文件描述符是一个非负整数，没打开或者创建一个文件，内核就会返回一个文件描述符，后续的操作都需要使用这个描述符来标记文件。</p>
<h4 id="打开文件">打开文件</h4>
<pre><code>#include&lt;fcntl.h&gt;

int open(const char *path, int oflag, .../*mode_t mode*/);
int openat(int fd, const char *path, int oflag, .../*mode_t mode*/);
//两函数的返回值，成功返回文件描述符的值，错误返回－1
</code></pre><p>fd参数把openat和open区别开来     </p>
<ul>
<li>当path是绝对路径名的时候，open等于openat。</li>
<li>当path是相对路径名的时候，fd指出来相对路径名在文件系统中的开始位置，其中fd通过打开相对路径名所在的路径来获取。</li>
<li>当path是相对路径名，fd的值是特殊值AT_FDCWD时，路径名在当前工作目录中获取。
openat主要是为了解决两个问题，第一个问题是让线程可以使用相对路径来打开文件，而不再只能打开当前工作目录，同一进程的线程共享同一个工作目录，很难让他们工作在不同的目录中，如果要用绝对路径的话，使用上又会受到很多限制。第二个问题是解决TOCTTOU(time-of-check-to-time-of-use)问题，提高程序的安全性。<br/>当文件名或路径名超出了系统规定的最大长度时，是截断还是返回出错由常量_POSIX_NO_TRIUNC决定。</li>
</ul>
<h4 id="创建文件">创建文件</h4>
<pre><code>#include&lt;fctl.h&gt;

int creat(const char *path, mode_t mode);
//成功返回只写打开的文件描述符，出错返回－1
</code></pre><p>等同于函数
<code>open(path, O_WRONLY | O_CREAT | O_TRUNC, mode);</code>
因为可以用open替代，于是也不用需要单独的open函数了。</p>
</section>
</div>
</div>
</div>
<a aria-label="Previous page: UNIX标准及其实现" class="navigation navigation-prev navigation-unique" href="./unixstandard.html"><i class="fa fa-angle-left"></i></a>
</div>
</div>
<script src="gitbook/app.js"></script>
<script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
<script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
<script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
<script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>
</body>
</html>
